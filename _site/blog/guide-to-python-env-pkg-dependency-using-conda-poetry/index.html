<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Essi Alizadeh">
<meta name="dcterms.date" content="2021-01-29">

<title>Essi Alizadeh - A Guide to Python Environment, Dependency and Package Management: Conda + Poetry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-180647948-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Essi Alizadeh - A Guide to Python Environment, Dependency and Package Management: Conda + Poetry">
<meta property="og:description" content="How to add packages to your environment files automatically without ever worrying about the dependencies">
<meta property="og:image" content="https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry/img/_featured_image.png">
<meta property="og:site-name" content="Essi Alizadeh">
<meta property="og:image:height" content="633">
<meta property="og:image:width" content="790">
<meta name="twitter:title" content="Essi Alizadeh - A Guide to Python Environment, Dependency and Package Management: Conda + Poetry">
<meta name="twitter:description" content="How to add packages to your environment files automatically without ever worrying about the dependencies">
<meta name="twitter:image" content="https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry/img/_featured_image.png">
<meta name="twitter:creator" content="@es_alizadeh">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="633">
<meta name="twitter:image-width" content="790">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Essi Alizadeh</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">A Guide to Python Environment, Dependency and Package Management: Conda + Poetry</h1>
            <p class="subtitle lead">How to add packages to your environment files automatically without ever worrying about the dependencies</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Conda</div>
                <div class="quarto-category">Package Management</div>
                <div class="quarto-category">Poetry</div>
                <div class="quarto-category">Programming</div>
                <div class="quarto-category">Python</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Essi Alizadeh </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 29, 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul>
  <li><a href="#a-quick-note-on-package-repositories" id="toc-a-quick-note-on-package-repositories" class="nav-link" data-scroll-target="#a-quick-note-on-package-repositories">A Quick Note on Package Repositories</a></li>
  </ul></li>
  <li><a href="#conda-jack-of-all-trades" id="toc-conda-jack-of-all-trades" class="nav-link" data-scroll-target="#conda-jack-of-all-trades">Conda: Jack of all trades?</a>
  <ul>
  <li><a href="#issues-with-conda" id="toc-issues-with-conda" class="nav-link" data-scroll-target="#issues-with-conda">Issues with conda</a>
  <ul class="collapse">
  <li><a href="#performance-issues" id="toc-performance-issues" class="nav-link" data-scroll-target="#performance-issues">Performance issues</a></li>
  <li><a href="#dependency-resolver-issues" id="toc-dependency-resolver-issues" class="nav-link" data-scroll-target="#dependency-resolver-issues">Dependency resolver issues</a></li>
  <li><a href="#python-packaging" id="toc-python-packaging" class="nav-link" data-scroll-target="#python-packaging">Python packaging</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#poetry" id="toc-poetry" class="nav-link" data-scroll-target="#poetry">Poetry</a>
  <ul>
  <li><a href="#pyproject.toml-python-configuration-file" id="toc-pyproject.toml-python-configuration-file" class="nav-link" data-scroll-target="#pyproject.toml-python-configuration-file">pyproject.toml: Python Configuration file</a></li>
  </ul></li>
  <li><a href="#the-proposed-setup" id="toc-the-proposed-setup" class="nav-link" data-scroll-target="#the-proposed-setup">The Proposed Setup</a>
  <ul>
  <li><a href="#step-1-create-a-minimal-conda-environment" id="toc-step-1-create-a-minimal-conda-environment" class="nav-link" data-scroll-target="#step-1-create-a-minimal-conda-environment">Step 1: Create a minimal conda environment</a></li>
  <li><a href="#step-2-install-poetry-tool" id="toc-step-2-install-poetry-tool" class="nav-link" data-scroll-target="#step-2-install-poetry-tool">Step 2: Install Poetry tool</a></li>
  <li><a href="#step-3-configure-your-poetry" id="toc-step-3-configure-your-poetry" class="nav-link" data-scroll-target="#step-3-configure-your-poetry">Step 3: Configure your Poetry</a></li>
  <li><a href="#step-4-installing-dependencies" id="toc-step-4-installing-dependencies" class="nav-link" data-scroll-target="#step-4-installing-dependencies">Step 4: Installing dependencies</a></li>
  </ul></li>
  <li><a href="#poetry-tips" id="toc-poetry-tips" class="nav-link" data-scroll-target="#poetry-tips">Poetry tips</a>
  <ul>
  <li><a href="#add-new-packages" id="toc-add-new-packages" class="nav-link" data-scroll-target="#add-new-packages">Add new packages</a></li>
  <li><a href="#remove-packages" id="toc-remove-packages" class="nav-link" data-scroll-target="#remove-packages">Remove packages</a></li>
  <li><a href="#show-package-dependencies" id="toc-show-package-dependencies" class="nav-link" data-scroll-target="#show-package-dependencies">Show package dependencies</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#useful-links" id="toc-useful-links" class="nav-link" data-scroll-target="#useful-links">Useful Links</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><img src="img/_featured_image.png" class="img-fluid" alt="A wordcloud of concepts used in the post."></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>👉 This article is also published on&nbsp;<a href="https://towardsdatascience.com/a-guide-to-python-environment-dependency-and-package-management-conda-poetry-f5a6c48d795"><strong>Towards Data Science blog</strong></a>.</p>
</div>
</div>
<p>If you work on multiple Python projects at different development stages, you probably have different environments on your system. There are various tools for creating an isolated environment and install the libraries you need for your project. This post discusses different available technologies for Python packaging, environment, and dependencies management systems. Then, we will go over an ideal setup (of course, in my opinion 🙂) suitable for most Python projects using <a href="https://conda.io/">conda</a> and <a href="https://python-poetry.org/">Poetry</a>.</p>
<p>In this post, <em>library</em> and <em>package</em> are used interchangeably, and they both refer to the Python package.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Let’s first list different groups of technologies and highlight few tools</p>
<ol type="1">
<li>An environment management system
<ul>
<li><a href="https://virtualenv.pypa.io/en/latest/">Virtualenv</a></li>
<li>Conda environment</li>
<li><a href="https://github.com/pypa/pipenv">Pipenv</a></li>
</ul></li>
<li>Package dependency resolver
<ul>
<li>Conda</li>
<li>Pipenv</li>
<li>Poetry</li>
</ul></li>
<li>Package repository
<ul>
<li><a href="https://pypi.org/">PyPI</a></li>
<li><a href="https://www.anaconda.com/">Anaconda</a></li>
<li><em>etc</em></li>
</ul></li>
</ol>
<section id="a-quick-note-on-package-repositories" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-note-on-package-repositories">A Quick Note on Package Repositories</h2>
<p>The most popular Python package repository is the Python Package Index (PyPI), a public repository for many Python libraries. You can install packages from PyPI by running <code>pip install package_name</code>. Python libraries can also be packaged using conda, and a popular host for conda packages is Anaconda. You can install conda packages by running <code>conda install package_name</code> in your conda environment.</p>
</section>
</section>
<section id="conda-jack-of-all-trades" class="level1">
<h1>Conda: Jack of all trades?</h1>
<p>Pipenv was created to address many shortcomings of virtualenv. However, the main reason I will not consider virtualenv nor the Pipenv as the environment managers are:</p>
<ul>
<li>I want to have the flexibility to install conda packages.</li>
<li>Unlike conda, both virtualenv and Pipenv are Python environments only.</li>
</ul>
<p>As you may note from the introduction, conda manages the environment and the packages, and the dependencies. Not only that, but it is language-agnostic too. Besides, conda can install PyPI packages by using pip in an active conda environment. You can install a fresh conda environment by running the following command</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-n</span> env_name python=3.7</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s always recommended to have an environment file that contains your libraries and their specific versions. This is important due to portability, maintainability, and reproducibility. You can create a conda environment from a file (e.g., environment.yaml file below) using the following command</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> environment.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> post</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> default</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.8</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pandas=1.1.0</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> pip=20.3.3</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">pip</span><span class="kw">:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">-</span><span class="at"> requests==2.25.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By now, you may say, great, conda does everything, so, let’s use conda packages in conda environments and let conda resolve any dependency issues.</p>
<section id="issues-with-conda" class="level2">
<h2 class="anchored" data-anchor-id="issues-with-conda">Issues with conda</h2>
<p>I think conda tries to do too much. After several years of using conda, here are few of my observations on conda as a package and dependency management:</p>
<section id="performance-issues" class="level3">
<h3 class="anchored" data-anchor-id="performance-issues">Performance issues</h3>
<p>My main problem with conda is its performance issues. Creating a new environment or even updating an old one may sometimes take a long time, especially if you have many packages. This is probably because conda tries to resolve the dependencies. There were few times that it took more than 30 minutes (yes, 30 minutes, not 30 seconds!) to create an environment. I initially thought that there is a connection issue or problems with connecting to the package repositories.</p>
</section>
<section id="dependency-resolver-issues" class="level3">
<h3 class="anchored" data-anchor-id="dependency-resolver-issues">Dependency resolver issues</h3>
<p>Conda may not even resolve the dependency issues. Since we cannot see the dependencies of specific conda packages (unlike Poetry), it may not be easy to resolve those issues.</p>
</section>
<section id="python-packaging" class="level3">
<h3 class="anchored" data-anchor-id="python-packaging">Python packaging</h3>
<p>Another issue with conda is when you want to build a conda package for your library and publish it. It’s not trivial (at least for me) since you would need several configuration files (like meta.yml, setup.py, <em>etc</em>.). You may have dependency issues too. You can find more information on how to build a conda package <a href="https://docs.conda.io/projects/conda-build/en/latest/user-guide/tutorials/build-pkgs.html">here</a>.</p>
</section>
</section>
</section>
<section id="poetry" class="level1">
<h1>Poetry</h1>
<p><a href="https://python-poetry.org/">Poetry</a> is a python packaging and dependency management system initially released in 2018. It smoothly handles the dependencies, especially if you use Poetry in a fresh environment and then add your Python packages. It can also handle other tools and configurations of your project in a deterministic way since it uses <a href="https://toml.io/en/">TOML</a> format as the Python configuration file. In a nutshell, TOML is intended for using an easy-to-read minimal configuration file. Poetry uses the <code>pyproject.toml</code> configuration file to install python packages and set up the configurations.</p>
<section id="pyproject.toml-python-configuration-file" class="level2">
<h2 class="anchored" data-anchor-id="pyproject.toml-python-configuration-file">pyproject.toml: Python Configuration file</h2>
<p><code>pyproject.toml</code> file is a new Python configuration file defined in <a href="https://www.python.org/dev/peps/pep-0518/">PEP518</a> to store build system requirements, dependencies, and many other configurations. You can even replace <code>setup.cfg</code> and <code>setup.py</code> files in most scenarios. You can save most configurations related to specific python packages like pytest, coverage, bumpversion, Black code styling, and many more in a single <code>pyproject.toml</code> file. You previously had to either write those configurations in individual files or other configuration files like <code>setup.cfg</code>. However, <code>pyproject.toml</code> can include all of them and also all project package requirements too.</p>
</section>
</section>
<section id="the-proposed-setup" class="level1">
<h1>The Proposed Setup</h1>
<p>I would recommend using conda as an environment manager, pip as the package installer, and Poetry as the dependency manager. In this case, you get all PyPI packages within the conda environment, and in rare cases where you want to install a conda package, you will be able to do so. Here are few benefits of using Poetry and the proposed setup:</p>
<ul>
<li>Better dependency management (often faster than conda dependency resolver)</li>
<li>Having most package configurations (e.g., pytest, coverage, bump2version, <em>etc.</em>) in a single file.</li>
<li>The ability to install a conda package if you have to (this should be your last resort!)</li>
<li>Poetry can automatically add new packages to <code>pyproject.toml</code> file.</li>
<li>Poetry can show the list of library dependencies of individual packages.</li>
<li>Build a Python package and publishing to PyPI is as easy as running two commands!</li>
<li>No need to have separate environment files for your production and development environments.</li>
</ul>
<section id="step-1-create-a-minimal-conda-environment" class="level2">
<h2 class="anchored" data-anchor-id="step-1-create-a-minimal-conda-environment">Step 1: Create a minimal conda environment</h2>
<p>You can create a conda environment from the following YAML file by running <code>conda env create -f environment.yaml</code>. This will create a fresh conda environment that has Python 3.8. In a conda environment, you can pass a list of channels (the order is important) from which you want to install your packages. In addition to the <em>default</em> channel on Anaconda Cloud that is curated by <a href="https://www.anaconda.com/">Anaconda</a> Inc., there are other channels that you can install packages. A popular channel is <a href="https://conda-forge.org/">conda-forge</a> that includes a community-led collection of packages. If you have a private conda channel, you can write it in the channels section.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> post</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">channels</span><span class="kw">:</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> default</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> conda-forge</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dependencies</span><span class="kw">:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> python=3.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-2-install-poetry-tool" class="level2">
<h2 class="anchored" data-anchor-id="step-2-install-poetry-tool">Step 2: Install Poetry tool</h2>
<p>You can install Poetry as per their instruction <a href="https://python-poetry.org/docs/#installation">here</a>. The recommended way is to install Poetry using the following command for OSx, Linux, or WSL (Windows Subsystem Linux).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sSL</span> https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py <span class="kw">|</span> <span class="ex">python</span> <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note: Installing Poetry using the preferred approach that is by the custom installer (the first approach that downloads get-poetry.py script) will install Poetry isolated from the rest of the system.</p>
<p>⚠️ Although not recommended, there is also a pip version of Poetry that you can install (<code>pip install poetry</code>). The developers warn against using the pip version in the documentation since it might cause some conflicts with other packages in the environment. But, if our environment is basically empty (although some base packages are installed like pip when creating a conda environment), then it is probably fine to install it through <code>pip</code>!</p>
</section>
<section id="step-3-configure-your-poetry" class="level2">
<h2 class="anchored" data-anchor-id="step-3-configure-your-poetry">Step 3: Configure your Poetry</h2>
<p>To configure Poetry for a new project, Poetry makes it very easy to create a configuration file with all your desired settings. You can interactively create a <code>pyproject.toml</code> file by simply running <code>poetry init</code>. This will prompt few questions about the desired Python packages you want to install. You can press Enter to process with default options.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/poetry_init.png" class="img-fluid figure-img" alt="Screenshot of the result of running command: poetry init"></p>
<p></p><figcaption class="figure-caption">Interactive configuration by running poetry init</figcaption><p></p>
</figure>
</div>
<p>As you can see in the above screenshot, you can add some packages only for development dependencies. Initializing the Poetry for your project will create the <code>pyproject.toml</code> file that includes all configurations we defined during the setup. We have one main section for all dependencies (used in both production and development environments), but we also have a section that contains packages used mainly for development purposes like pytest, sphinx, <em>etc</em>. This is the other advantage over other dependency management tools. You only need one configuration file for both your production and development environments.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">tool</span><span class="kw">.</span><span class="dt">poetry</span><span class="kw">]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"my_package"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.0.1"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">""</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">authors</span> <span class="op">=</span> <span class="op">[</span><span class="st">"ealizadeh &lt;abc@edf.com&gt;"</span><span class="op">]</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">tool</span><span class="kw">.</span><span class="dt">poetry</span><span class="kw">.</span><span class="dt">dependencies</span><span class="kw">]</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dt">python</span> <span class="op">=</span> <span class="st">"^3.8"</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dt">requests</span> <span class="op">=</span> <span class="st">"^2.25.1"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">tool</span><span class="kw">.</span><span class="dt">poetry</span><span class="kw">.</span><span class="dt">dev-dependencies</span><span class="kw">]</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dt">pytest</span> <span class="op">=</span> <span class="st">"^6.2.1"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">build-system</span><span class="kw">]</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">"poetry-core&gt;=1.0.0"</span><span class="op">]</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="dt">build-backend</span> <span class="op">=</span> <span class="st">"poetry.core.masonry.api"</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">tool</span><span class="kw">.</span><span class="dt">pytest</span><span class="kw">.</span><span class="dt">ini_options</span><span class="kw">]</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="dt">minversion</span> <span class="op">=</span> <span class="st">"6.0"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="dt">addopts</span> <span class="op">=</span> <span class="st">"-ra -q"</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="dt">testpaths</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tests"</span><span class="op">,</span>  <span class="co"># You should have a "tests" directory</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="step-4-installing-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="step-4-installing-dependencies">Step 4: Installing dependencies</h2>
<p>Once you have your dependencies and other configurations in a <code>pyproject.toml</code> file, you can install the dependencies by simply running</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> install</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will create a <code>poetry.lock</code> file. This file basically contains the exact versions of all the packages locking the project with those specific versions. You need to commit both the <code>pyproject.toml</code> file and <code>poetry.lock</code> file. I would strongly recommend you not to update the poetry.lock file manually. Let poetry does its magic!!</p>
</section>
</section>
<section id="poetry-tips" class="level1">
<h1>Poetry tips</h1>
<section id="add-new-packages" class="level2">
<h2 class="anchored" data-anchor-id="add-new-packages">Add new packages</h2>
<p>If you want to add (or remove) a package to your environment, I would highly recommend you to do so by using the following command:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> add package_name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will <em>automatically</em> add the package name and version to your <code>pyproject.toml</code> file and updates the poetry.lock accordingly. <code>poetry add</code> takes care of all dependencies, and adds the package in the <code>[tool.poetry.dependencies]</code> section.</p>
<p>If you want to add a package to your development environment, you can simly pass a <code>--dev</code> option as below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> add package_name <span class="at">--dev</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can specify a specific version of a package, or even adding a package through git+https or git+ssh (see <a href="https://python-poetry.org/docs/cli/#add">here</a> for more details).</p>
</section>
<section id="remove-packages" class="level2">
<h2 class="anchored" data-anchor-id="remove-packages">Remove packages</h2>
<p>You can remove a package as following:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> remove package_to_remove</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="show-package-dependencies" class="level2">
<h2 class="anchored" data-anchor-id="show-package-dependencies">Show package dependencies</h2>
<p>If you want to see a list of all installed packages in your environment, you can run the following command:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> show</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that this will show the package dependencies too. It is sometimes helpful to see the dependencies of a Python package. Fortunately, you can do so using <code>poetry show</code>. For instance, we can see the list of dependencies of <code>requests</code> package in our environment using the following command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> show requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/poetry_show_requests_dependencies.png" class="img-fluid figure-img" alt="Screenshot of running command: poetry show request"></p>
<p></p><figcaption class="figure-caption">All dependencies of requests package in the project</figcaption><p></p>
</figure>
</div>
<p>Even better, you can see all your project’s dependencies by just running:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">poetry</span> show <span class="at">--tree</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/poetry_show_tree.png" class="img-fluid figure-img" alt="Screenshot of running command: poetry show --tree"></p>
<p></p><figcaption class="figure-caption">A tree of all your project dependencies</figcaption><p></p>
</figure>
</div>
<p>From above figure, you can see that the blue-font package names (requests and pytest) are explicitly added to&nbsp;<code>pyproject.toml</code>&nbsp;file. Other libraries, in yellow, are their dependencies and do not need to be in your toml file.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may use&nbsp;<code>pip freeze</code>&nbsp;(<code>pip freeze &gt; requirements.txt</code>&nbsp;if you want to output the result into a file) to output all installed packages in your environment, but that will be quite messy.</p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this post, we talked about different Python environment, package management, and dependency resolver tools. Then, we went over a setup for how to use conda as the environment manager and Poetry as the package manager and dependency resolver, and the benefits of using this combination in your Python projects.</p>
<p>Hope you find this article useful.</p>
<hr>
</section>
<section id="useful-links" class="level1">
<h1>Useful Links</h1>
<p><a href="https://python-poetry.org/docs/">Introduction | Documentation | Poetry - Python dependency management and packaging made easy.</a></p>
<p><a href="https://github.com/carlosperate/awesome-pyproject">carlosperate/awesome-pyproject</a></p>
<p><a href="https://towardsdatascience.com/a-guide-to-conda-environments-bc6180fc533">The Definitive Guide to Conda Environments</a></p>
<p><a href="https://ahmed-nafies.medium.com/pip-pipenv-poetry-or-conda-7d2398adbac9">Pip, Pipenv, Poetry or Conda</a></p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{alizadeh2021,
  author = {Essi Alizadeh},
  editor = {},
  title = {A {Guide} to {Python} {Environment,} {Dependency} and
    {Package} {Management:} {Conda} + {Poetry}},
  date = {2021-01-29},
  url = {https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-alizadeh2021" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Essi Alizadeh. 2021. <span>“A Guide to Python Environment, Dependency
and Package Management: Conda + Poetry.”</span> January 29, 2021. <a href="https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry">https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">©️ 2022 Esmaeil Alizadeh - All Rights Reserved</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/e-alizadeh">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/es_alizadeh">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>